import{r as d,f as b,s as a,c,a as r,b as e,d as V,u as g,F as L,e as B,w as k,v as x,n as m,t as v,g as F}from"./index-6h8_Kgxn.js";import{_ as O,a as C,g as P}from"./_plugin-vue_export-helper-Bb7mbNmN.js";const $={class:"container py-4"},j={key:0,class:"alert alert-info"},T={key:1,class:"list-group mb-3"},z={class:"d-flex align-items-center gap-3"},D={class:"cart-item-title"},M={class:"cart-item-location"},S=["onClick"],U={class:"row g-3 mb-3"},A={class:"col-md-6"},E={class:"col-md-6"},R=["disabled"],W={__name:"CartPage",setup(Y){function I(l){const[s]=a.cartItems.splice(l,1),t=a.lessons.find(n=>n._id===s._id);t&&(t.space+=1)}const i=d(""),u=d(""),p=d(!1),o=d(""),_=b(()=>/^[A-Za-z ]+$/.test(i.value.trim())),h=b(()=>/^[0-9]+$/.test(u.value.trim())),y=b(()=>a.cartItems.length>0&&_.value&&h.value);async function w(){if(y.value){p.value=!0,o.value="";try{const l=a.cartItems.map(t=>t._id);await C.createOrder({name:i.value.trim(),phone:u.value.trim(),lessonIds:l,spaces:a.cartItems.length});const s=l.reduce((t,n)=>(t[n]=(t[n]||0)+1,t),{});for(const[t,n]of Object.entries(s)){const f=a.lessons.find(N=>N._id===t);f&&await C.updateLesson(t,{space:Math.max(0,Number(f.space))})}a.cartItems=[],o.value="Order submitted successfully."}catch(l){o.value=`Checkout failed: ${l.message||l}`}finally{p.value=!1}}}return(l,s)=>(r(),c("div",$,[s[5]||(s[5]=e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[e("h1",{class:"mb-0"},"Shopping Cart"),e("a",{class:"btn btn-outline-light",href:"#/"},"Back to Lessons")],-1)),g(a).cartItems.length===0?(r(),c("div",j,"Your cart is empty.")):(r(),c("ul",T,[(r(!0),c(L,null,B(g(a).cartItems,(t,n)=>(r(),c("li",{key:n,class:"list-group-item d-flex justify-content-between align-items-center cart-item"},[e("div",z,[e("i",{class:m(["fa-solid cart-icon",g(P)(t.topic)])},null,2),e("div",null,[e("div",D,v(t.topic),1),e("div",M,[s[2]||(s[2]=e("i",{class:"fa-solid fa-map-marker-alt me-1 text-brand"},null,-1)),F(" "+v(t.location)+" — £"+v(t.price),1)])])]),e("button",{class:"btn btn-sm btn-outline-danger",onClick:f=>I(n)},"Remove",8,S)]))),128))])),s[6]||(s[6]=e("h2",{class:"h5"},"Checkout",-1)),e("div",U,[e("div",A,[s[3]||(s[3]=e("label",{class:"form-label"},"Name",-1)),k(e("input",{class:"form-control","onUpdate:modelValue":s[0]||(s[0]=t=>i.value=t),placeholder:"Letters only"},null,512),[[x,i.value]]),e("div",{class:m(["form-text",{"text-danger":i.value.value&&!_.value}])},"Name must contain letters and spaces only.",2)]),e("div",E,[s[4]||(s[4]=e("label",{class:"form-label"},"Phone",-1)),k(e("input",{class:"form-control","onUpdate:modelValue":s[1]||(s[1]=t=>u.value=t),placeholder:"Numbers only"},null,512),[[x,u.value]]),e("div",{class:m(["form-text",{"text-danger":u.value.value&&!h.value}])},"Phone must contain numbers only.",2)])]),e("button",{class:"btn btn-success",disabled:!y.value||p.value,onClick:w},"Checkout",8,R),o.value?(r(),c("div",{key:2,class:m(["mt-3",o.value.startsWith("Order")?"alert alert-success":"alert alert-warning"])},v(o.value),3)):V("",!0)]))}},G=O(W,[["__scopeId","data-v-c19a476b"]]);export{G as default};
