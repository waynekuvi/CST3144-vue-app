import{r as d,f as g,s as a,c,a as r,b as t,d as V,u as y,F as B,e as F,w as x,v as w,n as m,t as f}from"./index-BYqo0DnC.js";import{a as I}from"./api-BU1MpDmd.js";const O={math:"fa-calculator",english:"fa-book",science:"fa-flask",history:"fa-landmark",geography:"fa-globe",art:"fa-palette",music:"fa-music","computer science":"fa-laptop-code",physics:"fa-atom",chemistry:"fa-vial"};function P(v){if(!v)return"fa-book";const p=String(v).toLowerCase().trim();return O[p]||"fa-book"}const $={class:"container py-4"},j={key:0,class:"alert alert-info"},M={key:1,class:"list-group mb-3"},S={class:"d-flex align-items-center gap-3"},z={class:"fw-semibold"},A={class:"text-muted"},D=["onClick"],T={class:"row g-3 mb-3"},U={class:"col-md-6"},E={class:"col-md-6"},R=["disabled"],Z={__name:"CartPage",setup(v){function p(l){const[s]=a.cartItems.splice(l,1),e=a.lessons.find(o=>o._id===s._id);e&&(e.space+=1)}const i=d(""),u=d(""),b=d(!1),n=d(""),_=g(()=>/^[A-Za-z ]+$/.test(i.value.trim())),k=g(()=>/^[0-9]+$/.test(u.value.trim())),C=g(()=>a.cartItems.length>0&&_.value&&k.value);async function L(){if(C.value){b.value=!0,n.value="";try{const l=a.cartItems.map(e=>e._id);await I.createOrder({name:i.value.trim(),phone:u.value.trim(),lessonIds:l,spaces:a.cartItems.length});const s=l.reduce((e,o)=>(e[o]=(e[o]||0)+1,e),{});for(const[e,o]of Object.entries(s)){const h=a.lessons.find(N=>N._id===e);h&&await I.updateLesson(e,{space:Math.max(0,Number(h.space))})}a.cartItems=[],n.value="Order submitted successfully."}catch(l){n.value=`Checkout failed: ${l.message||l}`}finally{b.value=!1}}}return(l,s)=>(r(),c("div",$,[s[4]||(s[4]=t("div",{class:"d-flex justify-content-between align-items-center mb-3"},[t("h1",{class:"mb-0"},"Shopping Cart"),t("a",{class:"btn btn-outline-light",href:"#/"},"Back to Lessons")],-1)),y(a).cartItems.length===0?(r(),c("div",j,"Your cart is empty.")):(r(),c("ul",M,[(r(!0),c(B,null,F(y(a).cartItems,(e,o)=>(r(),c("li",{key:o,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",S,[t("i",{class:m(["fa-solid",y(P)(e.topic)])},null,2),t("div",null,[t("div",z,f(e.topic),1),t("small",A,f(e.location)+" — £"+f(e.price),1)])]),t("button",{class:"btn btn-sm btn-outline-danger",onClick:h=>p(o)},"Remove",8,D)]))),128))])),s[5]||(s[5]=t("h2",{class:"h5"},"Checkout",-1)),t("div",T,[t("div",U,[s[2]||(s[2]=t("label",{class:"form-label"},"Name",-1)),x(t("input",{class:"form-control","onUpdate:modelValue":s[0]||(s[0]=e=>i.value=e),placeholder:"Letters only"},null,512),[[w,i.value]]),t("div",{class:m(["form-text",{"text-danger":i.value.value&&!_.value}])},"Name must contain letters and spaces only.",2)]),t("div",E,[s[3]||(s[3]=t("label",{class:"form-label"},"Phone",-1)),x(t("input",{class:"form-control","onUpdate:modelValue":s[1]||(s[1]=e=>u.value=e),placeholder:"Numbers only"},null,512),[[w,u.value]]),t("div",{class:m(["form-text",{"text-danger":u.value.value&&!k.value}])},"Phone must contain numbers only.",2)])]),t("button",{class:"btn btn-success",disabled:!C.value||b.value,onClick:L},"Checkout",8,R),n.value?(r(),c("div",{key:2,class:m(["mt-3",n.value.startsWith("Order")?"alert alert-success":"alert alert-warning"])},f(n.value),3)):V("",!0)]))}};export{Z as default};
